<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MietRadar München – MVP Starter</title>
  <link rel="preconnect" href="https://unpkg.com">
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    :root{
      --bg:#0b0d12; --panel:#141822; --muted:#8b94a7; --text:#e6eaf2; --accent:#5de4c7; --accent2:#7aa2f7; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; color:var(--text); background:linear-gradient(180deg,#0b0d12 0%, #0e111a 100%);} 
    header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(8px); background:rgba(11,13,18,.7); border-bottom:1px solid #1f2533}
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px}
    .brand .dot{width:10px; height:10px; border-radius:999px; background:var(--accent)}
    .grid{display:grid; grid-template-columns: 360px 1fr; gap:16px}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr;}}
    .card{background:var(--panel); border:1px solid #1f2533; border-radius:14px; padding:14px; box-shadow:0 6px 24px rgba(0,0,0,.25)}
    h1{font-size:22px; margin:0}
    h2{font-size:16px; margin:0 0 10px 0; color:#c9d3ea}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
    input, select{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #273043; background:#0f1320; color:var(--text)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .btn{display:inline-flex; align-items:center; gap:8px; background:linear-gradient(135deg, var(--accent2), var(--accent)); color:#0a0f1a; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer}
    .btn.secondary{background:#0f1320; color:var(--text); border:1px solid #273043}
    .kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
    @media (max-width:900px){ .kpis{grid-template-columns:1fr 1fr}}
    .kpi{padding:12px; border-radius:12px; background:#0f1320; border:1px dashed #273043}
    .kpi .val{font-weight:800; font-size:20px}
    .kpi .lbl{font-size:12px; color:var(--muted)}
    #map{height:420px; border-radius:14px; overflow:hidden}
    .list{display:grid; gap:10px; margin-top:10px}
    .item{display:grid; grid-template-columns:110px 1fr; gap:12px; background:#0f1320; border:1px solid #273043; border-radius:12px; padding:10px}
    .thumb{background:#111524; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:12px; color:#65708a}
    .meta{display:flex; gap:10px; flex-wrap:wrap; font-size:12px; color:#aab3c7}
    footer{padding:30px 16px; color:#8b94a7; font-size:12px; text-align:center}
    .badge{display:inline-block; padding:4px 8px; border-radius:999px; background:#111524; border:1px solid #273043; font-size:11px}
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between; gap:16px">
      <div class="brand"><span class="dot"></span><span>MietRadar München</span></div>
      <nav style="display:flex; gap:12px; align-items:center">
        <span class="badge">MVP</span>
        <a href="#methodik" style="color:var(--muted); text-decoration:none">Methodik</a>
      </nav>
    </div>
  </header>

  <main class="wrap" style="margin-top:18px">
    <div class="grid">
      <!-- Sidebar: Filter -->
      <section class="card">
        <h2>Suche & Filter</h2>
        <label for="q">Stadt/Bezirk</label>
        <input id="q" placeholder="z. B. Schwabing-West" value="München"/>
        <div class="row">
          <div>
            <label for="maxRent">Max. Kaltmiete (€)</label>
            <input id="maxRent" type="number" placeholder="1400" />
          </div>
          <div>
            <label for="rooms">Min. Zimmer</label>
            <select id="rooms">
              <option value="0">egal</option>
              <option value="1">1+</option>
              <option value="2" selected>2+</option>
              <option value="3">3+</option>
              <option value="4">4+</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div>
            <label for="district">Stadtteil</label>
            <select id="district">
              <option value="">alle</option>
              <option>Altstadt-Lehel</option>
              <option>Maxvorstadt</option>
              <option>Schwabing-West</option>
              <option>Neuhausen-Nymphenburg</option>
              <option>Haidhausen</option>
              <option>Sendling</option>
            </select>
          </div>
          <div>
            <label for="sort">Sortierung</label>
            <select id="sort">
              <option value="recent">Neueste zuerst</option>
              <option value="priceAsc">Preis ↑</option>
              <option value="priceDesc">Preis ↓</option>
              <option value="sqmAsc">€/m² ↑</option>
              <option value="sqmDesc">€/m² ↓</option>
            </select>
          </div>
        </div>
        <div style="display:flex; gap:10px; margin-top:12px">
          <button class="btn" id="applyBtn">Filtern</button>
          <button class="btn secondary" id="resetBtn">Zurücksetzen</button>
        </div>
        <div style="margin-top:12px; font-size:12px; color:var(--muted)">
          Daten sind Demo‑Einträge. Später via <code>/api/offers</code> ersetzbar.
        </div>
      </section>

      <!-- Main: KPIs, Map, List -->
      <section class="card">
        <div class="kpis">
          <div class="kpi"><div class="lbl">Angebote</div><div class="val" id="kpiCount">–</div></div>
          <div class="kpi"><div class="lbl">Median €/m²</div><div class="val" id="kpiMedian">–</div></div>
          <div class="kpi"><div class="lbl">Ø Zimmer</div><div class="val" id="kpiRooms">–</div></div>
        </div>
        <div style="margin-top:12px" id="map" aria-label="Karte München"></div>
        <div class="list" id="results"></div>
      </section>
    </div>

    <section id="methodik" class="card" style="margin-top:16px">
      <h2>Methodik & Transparenz</h2>
      <p style="color:var(--muted)">Diese Demo nutzt synthetische Daten. In Produktion werden nur Quellen verwendet, deren AGB eine automatisierte Abfrage erlauben oder die offizielle APIs bereitstellen. Geodaten: OpenStreetMap-Mitwirkende. Keine Speicherung von PII.</p>
    </section>
  </main>

  <footer>
    © 2025 MietRadar München · Karten © OpenStreetMap-Mitwirkende · Tiles via OSM/Leaflet
  </footer>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    // --- Demo-Daten (ersetzbar durch API) ---
    const demoOffers = [
      {id:1, title:"2-Zi Altbau nahe Hohenzollernplatz", price:1350, size:48, rooms:2, district:"Schwabing-West", lat:48.1655, lng:11.5722, date:"2025-10-08"},
      {id:2, title:"3-Zi Neubau, Balkon, U2 Josephsburg", price:1750, size:72, rooms:3, district:"Haidhausen", lat:48.1258, lng:11.6077, date:"2025-10-09"},
      {id:3, title:"1,5-Zi Studio Maxvorstadt", price:990, size:30, rooms:1.5, district:"Maxvorstadt", lat:48.1497, lng:11.5670, date:"2025-10-07"},
      {id:4, title:"Familienfreundlich am Rotkreuzplatz", price:1950, size:83, rooms:3, district:"Neuhausen-Nymphenburg", lat:48.1560, lng:11.5325, date:"2025-10-09"},
      {id:5, title:"1-Zi Nähe Gärtnerplatz", price:1200, size:28, rooms:1, district:"Altstadt-Lehel", lat:48.1340, lng:11.5796, date:"2025-10-06"},
      {id:6, title:"4-Zi Dachgeschoss Sendling", price:2200, size:96, rooms:4, district:"Sendling", lat:48.1115, lng:11.5412, date:"2025-10-08"}
    ].map(o => ({...o, pricePerSqm: +(o.price / o.size).toFixed(2)}));

    // --- Map ---
    const map = L.map('map').setView([48.137154, 11.576124], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>'
    }).addTo(map);
    let markersLayer = L.layerGroup().addTo(map);

    function renderMarkers(items){
      markersLayer.clearLayers();
      items.forEach(o => {
        const m = L.marker([o.lat, o.lng]).bindPopup(
          `<b>${o.title}</b><br/>${o.rooms} Zi · ${o.size} m²<br/><b>${o.price} €</b> (${o.pricePerSqm} €/m²)<br/><small>${o.district}</small>`
        );
        markersLayer.addLayer(m);
      });
    }

    // --- UI Rendering ---
    const resultsEl = document.getElementById('results');
    const kpiCount = document.getElementById('kpiCount');
    const kpiMedian = document.getElementById('kpiMedian');
    const kpiRooms = document.getElementById('kpiRooms');

    function median(arr){
      if(!arr.length) return 0; const s=[...arr].sort((a,b)=>a-b); const mid=Math.floor(s.length/2); return s.length%2? s[mid] : (s[mid-1]+s[mid])/2
    }

    function renderList(items){
      resultsEl.innerHTML = items.map(o => `
        <article class="item" aria-label="Angebot">
          <div class="thumb">${o.district}</div>
          <div>
            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px">
              <h3 style="margin:0; font-size:16px">${o.title}</h3>
              <div class="badge">${new Date(o.date).toLocaleDateString('de-DE')}</div>
            </div>
            <div class="meta">
              <span>${o.rooms} Zi</span>
              <span>${o.size} m²</span>
              <span><b>${o.price} €</b> (${o.pricePerSqm} €/m²)</span>
              <span>${o.district}</span>
            </div>
          </div>
        </article>
      `).join('');
    }

    function renderKpis(items){
      kpiCount.textContent = items.length;
      const med = median(items.map(o=>o.pricePerSqm));
      kpiMedian.textContent = med ? med.toFixed(0) : '–';
      const avgRooms = items.length ? (items.reduce((s,o)=>s+o.rooms,0)/items.length) : 0;
      kpiRooms.textContent = avgRooms ? avgRooms.toFixed(1) : '–';
    }

    // --- Filtering ---
    const q = document.getElementById('q');
    const maxRent = document.getElementById('maxRent');
    const rooms = document.getElementById('rooms');
    const district = document.getElementById('district');
    const sort = document.getElementById('sort');

    function applyFilters(){
      let items = [...demoOffers];
      const qv = (q.value||'').toLowerCase();
      if(qv){ items = items.filter(o => o.title.toLowerCase().includes(qv) || o.district.toLowerCase().includes(qv) ); }
      const max = parseFloat(maxRent.value);
      if(!isNaN(max)){ items = items.filter(o => o.price <= max); }
      const minRooms = parseFloat(rooms.value);
      if(minRooms>0){ items = items.filter(o => o.rooms >= minRooms); }
      if(district.value){ items = items.filter(o => o.district === district.value); }
      switch(sort.value){
        case 'priceAsc': items.sort((a,b)=>a.price-b.price); break;
        case 'priceDesc': items.sort((a,b)=>b.price-a.price); break;
        case 'sqmAsc': items.sort((a,b)=>a.pricePerSqm-b.pricePerSqm); break;
        case 'sqmDesc': items.sort((a,b)=>b.pricePerSqm-a.pricePerSqm); break;
        default: items.sort((a,b)=> new Date(b.date)-new Date(a.date));
      }
      renderList(items);
      renderMarkers(items);
      renderKpis(items);
    }

    document.getElementById('applyBtn').addEventListener('click', applyFilters);
    document.getElementById('resetBtn').addEventListener('click', () => {
      q.value = 'München'; maxRent.value=''; rooms.value='2'; district.value=''; sort.value='recent'; applyFilters();
    });

    // Initial render
    applyFilters();

    // --- API-Hook (später) ---
    // fetch('/api/offers?city=muenchen').then(r=>r.json()).then(data=>{ /* map auf schema, dann applyFilters() */ })
  </script>
</body>
</html>
